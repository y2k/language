package im.y2k.chargetimer;import android.app.Activity;import android.app.NotificationChannel;import android.app.Notification;import android.app.NotificationManager;import android.app.job.JobScheduler;import android.app.job.JobParameters;import android.app.job.JobInfo;import android.R;import android.content.Intent;import android.content.IntentFilter;import android.content.Context;import android.content.ComponentName;import android.media.AudioManager;import android.media.RingtoneManager;import android.os.Handler;import java.util.Objects;import android.webkit.WebView;class Main_shared {public static int LIMIT_CHARGE=80;

private static Object get_status(final Object env){final var ctx=(Context)y2k.RT.get(env,"context");final var wv=(WebView)y2k.RT.get(env,"webview");final var level=ctx.registerReceiver(null,new IntentFilter(Intent.ACTION_BATTERY_CHANGED)).getIntExtra("level",-1);final var m=(JobInfo.getMinPeriodMillis()/1000);final var reason=ctx.getSystemService(JobScheduler.class).getPendingJob(123);wv.evaluateJavascript(y2k.RT.str("window.update_ui(\"#text_job_status\", \"",level,"% | ",LIMIT_CHARGE,"% | ",m," sec | ",reason,"\")"),null);final var p__1=(Void)null;return p__1;}
private static Object start_job(final Object env){final var activity=(Context)y2k.RT.get(env,"context");final var job_info=new JobInfo.Builder(123,new ComponentName(activity,"im.y2k.chargetimer.Main_android$ChargeJobService")).setPeriodic(300000).setRequiresCharging(true).build();final var job_scheduler=activity.getSystemService(JobScheduler.class);job_scheduler.schedule(job_info);final var p__2=get_status(env);return p__2;}
private static Object stop_job(final Object env){final var activity=(Context)y2k.RT.get(env,"context");activity.getSystemService(JobScheduler.class).cancel(123);final var p__3=get_status(env);return p__3;}
private static Object show_notification(final Object env){final var context=(Context)y2k.RT.get(env,"context");final var nm=context.getSystemService(NotificationManager.class);final var channelId="test_channel";final var ch=new NotificationChannel(channelId,channelId,NotificationManager.IMPORTANCE_DEFAULT);final var n=new Notification.Builder(context,channelId).setSmallIcon(R.drawable.ic_dialog_info).setContentTitle("Test").setContentText("Test").build();nm.createNotificationChannel(ch);nm.notify(1,n);final var p__4=(Void)null;return p__4;}
private static Object play_alarm(final Context context){final var am=(AudioManager)context.getSystemService(Context.AUDIO_SERVICE);final var sound_stream_id=5;final var max=am.getStreamMaxVolume(sound_stream_id);am.setStreamVolume(sound_stream_id,max,0);final var notification=RingtoneManager.getDefaultUri(RingtoneManager.TYPE_ALARM);final var r=RingtoneManager.getRingtone(context,notification);r.play();final var p__6=new Handler().postDelayed(y2k.RT.runnable(()->{r.stop();return (Void)null;}),1000);final var p__5=p__6;return p__5;}
private static Object play_alarm_pressed(final Object env){return play_alarm(y2k.RT.get(env,"context"));}
private static Object job_scheduled(final Object env){final var ctx=(Context)y2k.RT.get(env,"context");final var level=ctx.registerReceiver(null,new IntentFilter(Intent.ACTION_BATTERY_CHANGED)).getIntExtra("level",-1);final Object p__8;if((level>LIMIT_CHARGE)){p__8=play_alarm(ctx);}else{p__8=null;}final var p__7=p__8;return p__7;}
public static Object dispatch(final Object env,final Object event,final Object payload){final var gen_1=event;final Object p__15;if(Objects.equals(gen_1,"show_notification")){p__15=show_notification(env);}else{final Object p__14;if(Objects.equals(gen_1,"get_info_pressed")){p__14=get_status(env);}else{final Object p__13;if(Objects.equals(gen_1,"start_pressed")){p__13=start_job(env);}else{final Object p__12;if(Objects.equals(gen_1,"stop_pressed")){p__12=stop_job(env);}else{final Object p__11;if(Objects.equals(gen_1,"play_alarm_pressed")){p__11=play_alarm_pressed(env);}else{final Object p__10;if(Objects.equals(gen_1,"job_started")){p__10=job_scheduled(env);}else{p__10=y2k.RT.println("[ERROR] unknown event: ",event);}p__11=p__10;}p__12=p__11;}p__13=p__12;}p__14=p__13;}p__15=p__14;}final var p__9=p__15;return p__9;}}